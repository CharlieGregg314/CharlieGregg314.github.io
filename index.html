<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agreement is cool</title>
    <script src="struct.js"></script>
    
</head>
<body>
    <p id="p"></p>
</body>
<script>
    function generate_response(source, depth) {
        text = structures[source].start
        return generate(text, depth, structures[source].structure)
    }
    function generate_from(pool, depth, struct) {
        if (depth>0) {
            let text = pool[Math.floor(Math.random()*(pool.length-1)+1)]
            return generate(text, depth-1, struct)
        } else {
            return generate(pool[0], 0, struct)
        }
    }
    function generate(text, depth, struct) {
        for (const label in struct) {
            if (Object.hasOwnProperty.call(struct, label)) {
                while (text.includes(label)) {
                    text = text.replace(label, generate_from(struct[label], depth, struct))
                }
            }
        }
        return text
    }
    const p = document.getElementById("p")
    const qstring = new Proxy(new URLSearchParams(window.location.search), {
        get: (searchParams, prop) => searchParams.get(prop),
    })
    let depth = 10
    if (qstring.depth) {
        depth = Number(qstring.depth)
    }
    p.innerHTML = generate_response("agree", depth)
</script>
</html>
